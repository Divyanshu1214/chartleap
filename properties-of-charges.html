<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Properties of Charges 3D Simulation - Interactive Lab | chartleap</title>
    <meta name="description" content="Aaveshon ke gundharm (properties of charges) ko 3D mein samjhein. Attraction, repulsion aur quantization ko interactive simulation ke saath seekhein.">
    <meta name="keywords" content="electric charge properties, aaveshon ke gun, attraction and repulsion 3d, quantization of charge simulation, physics interactive lab">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Inter', 'Noto Sans Devanagari', sans-serif;
            background-color: #111827;
        }
        canvas {
            display: block;
        }
        .glass-panel {
            background-color: rgba(31, 41, 55, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 0.75rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        #info-panel {
            position: absolute;
            top: 1rem;
            left: 1rem;
            padding: 1rem;
            color: white;
        }
        #controls {
            position: absolute;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1rem;
            padding: 1rem;
        }
        .control-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            color: white;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        .positive-btn {
            background: linear-gradient(145deg, #38bdf8, #0ea5e9);
            box-shadow: 0 4px 15px rgba(56, 189, 248, 0.3);
        }
        .positive-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(56, 189, 248, 0.4);
        }
        .negative-btn {
            background: linear-gradient(145deg, #f87171, #ef4444);
            box-shadow: 0 4px 15px rgba(248, 113, 113, 0.3);
        }
        .negative-btn:hover {
             transform: translateY(-3px);
             box-shadow: 0 6px 20px rgba(248, 113, 113, 0.4);
        }
        #reset-btn {
            background: linear-gradient(145deg, #9ca3af, #6b7280);
            box-shadow: 0 4px 15px rgba(156, 163, 175, 0.3);
        }
        #reset-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(156, 163, 175, 0.4);
        }
        #charge-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 2rem;
            color: white;
            display: none;
            flex-direction: column;
            gap: 1.5rem;
            align-items: center;
            width: 320px;
        }
        #charge-value-display {
            font-size: 2.5rem;
            font-weight: bold;
            min-width: 120px;
            text-align: center;
        }
        .charge-adjust-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 2rem;
            line-height: 44px;
            cursor: pointer;
            background-color: #4b5563;
            transition: background-color 0.2s;
        }
        .charge-adjust-btn:hover { background-color: #6b7280; }
        #save-charge-btn {
            background-color: #2563eb;
            padding: 0.75rem 2.5rem;
            border-radius: 0.5rem;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }
        #save-charge-btn:hover { background-color: #1d4ed8; }
        #tip-box {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(25, 147, 251, 0.1);
            color: #38bdf8;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #38bdf8;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            pointer-events: none;
            max-width: 90%;
            text-align: center;
        }
        #tip-box.visible {
            opacity: 1;
            transform: translate(-50%, -10px);
        }
        .particle-label-container {
            position: absolute;
            color: white;
            font-weight: bold;
            text-shadow: 0 0 5px black;
            pointer-events: none;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>
    <div id="info-panel" class="glass-panel">
        <h1 class="text-xl font-bold mb-2">सिमुलेशन स्थिति</h1>
        <p>कुल आवेश: <span id="total-charge" class="font-bold text-lg">0 e</span></p>
        <p>कणों की संख्या: <span id="particle-count" class="font-bold text-lg">0</span></p>
    </div>

    <div id="controls" class="glass-panel">
        <button id="add-positive" class="control-btn positive-btn">➕ धनात्मक</button>
        <button id="add-negative" class="control-btn negative-btn">➖ ऋणात्मक</button>
        <button id="reset-btn" class="control-btn">रीसेट</button>
    </div>

    <div id="charge-modal" class="glass-panel">
        <h2 class="text-2xl font-bold">आवेश बदलें</h2>
        <div class="flex items-center gap-4">
            <button id="decrease-charge" class="charge-adjust-btn">-</button>
            <span id="charge-value-display">+1 e</span>
            <button id="increase-charge" class="charge-adjust-btn">+</button>
        </div>
        <button id="save-charge-btn">सहेजें</button>
    </div>

    <div id="tip-box"></div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls;
        let particles = [];
        let forceLines = [];
        let addMode = null;
        let selectedParticle = null;

        const plane = new THREE.Plane(new THREE.Vector3(0, 1, 0), 0);
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        const tips = [
            "समान आवेश एक दूसरे को प्रतिकर्षित करते हैं!",
            "विपरीत आवेश एक दूसरे को आकर्षित करते हैं!",
            "सिस्टम का कुल आवेश हमेशा संरक्षित रहता है।",
            "कण पर क्लिक करके उसका आवेश बदलें (क्वांटीकरण)।",
            "दृश्य को घुमाने के लिए माउस ड्रैग करें और ज़ूम करने के लिए स्क्रॉल करें।"
        ];
        let tipIndex = 0;
        let tipTimeout;

        const ui = {
            totalCharge: document.getElementById('total-charge'),
            particleCount: document.getElementById('particle-count'),
            addPositiveBtn: document.getElementById('add-positive'),
            addNegativeBtn: document.getElementById('add-negative'),
            resetBtn: document.getElementById('reset-btn'),
            modal: document.getElementById('charge-modal'),
            chargeValueDisplay: document.getElementById('charge-value-display'),
            increaseChargeBtn: document.getElementById('increase-charge'),
            decreaseChargeBtn: document.getElementById('decrease-charge'),
            saveChargeBtn: document.getElementById('save-charge-btn'),
            tipBox: document.getElementById('tip-box')
        };

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111827);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 20, 35);
            // ***FIXED LINE IS HERE***
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            scene.add(new THREE.AmbientLight(0xffffff, 0.8));
            const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
            dirLight.position.set(5, 10, 7.5);
            scene.add(dirLight);
            const gridHelper = new THREE.GridHelper(100, 100, 0x444444, 0x444444);
            scene.add(gridHelper);
            setupEventListeners();
            animate();
            showTip();
            setInterval(showTip, 10000);
        }

        function setupEventListeners() {
            ui.addPositiveBtn.addEventListener('click', () => setAddMode('positive'));
            ui.addNegativeBtn.addEventListener('click', () => setAddMode('negative'));
            ui.resetBtn.addEventListener('click', resetSimulation);
            window.addEventListener('resize', onWindowResize);
            renderer.domElement.addEventListener('pointermove', onMouseMove);
            renderer.domElement.addEventListener('click', onCanvasClick);
            ui.increaseChargeBtn.addEventListener('click', () => adjustCharge(1));
            ui.decreaseChargeBtn.addEventListener('click', () => adjustCharge(-1));
            ui.saveChargeBtn.addEventListener('click', hideChargeModal);
        }

        function showTip(customMessage) {
            if (tipTimeout) clearTimeout(tipTimeout);

            if (customMessage) {
                ui.tipBox.textContent = customMessage;
            } else {
                ui.tipBox.textContent = tips[tipIndex];
                tipIndex = (tipIndex + 1) % tips.length;
            }

            ui.tipBox.classList.add('visible');
            tipTimeout = setTimeout(() => {
                ui.tipBox.classList.remove('visible');
            }, 5000);
        }

        function setAddMode(mode) {
            addMode = mode;
            document.body.style.cursor = 'crosshair';
            showTip("3D स्पेस में कहीं भी क्लिक करके कण जोड़ें।");
        }

        function createParticle(chargeValue, position) {
            const isPositive = chargeValue > 0;
            const radius = 1 + Math.log(Math.abs(chargeValue) + 1) * 0.5;
            const geometry = new THREE.SphereGeometry(radius, 32, 32);
            const color = isPositive ? 0x38bdf8 : 0xf87171;
            const material = new THREE.MeshStandardMaterial({
                color: color, metalness: 0.3, roughness: 0.4,
                emissive: color, emissiveIntensity: 0.3
            });
            const particle = new THREE.Mesh(geometry, material);
            particle.position.copy(position);
            particle.userData = {
                charge: chargeValue,
                velocity: new THREE.Vector3(0, 0, 0),
                force: new THREE.Vector3(0, 0, 0),
                labelContainer: createLabel(chargeValue)
            };
            scene.add(particle);
            particles.push(particle);
            updateInfoPanel();
        }

        function createLabel(chargeValue) {
            const container = document.createElement('div');
            container.className = 'particle-label-container';
            document.body.appendChild(container);
            updateLabelContent(container, chargeValue);
            return container;
        }

        function updateLabelContent(container, chargeValue) {
            const sign = chargeValue > 0 ? '+' : '−';
            container.textContent = `${sign}${Math.abs(chargeValue)}e`;
            container.style.fontSize = `${16 + Math.abs(chargeValue) * 1.5}px`;
        }

        function updateLabels() {
            for (const p of particles) {
                const screenPosition = p.position.clone().project(camera);
                if (screenPosition.z > 1) {
                     p.userData.labelContainer.style.display = 'none';
                     continue;
                }
                p.userData.labelContainer.style.display = 'block';
                const x = (screenPosition.x * 0.5 + 0.5) * window.innerWidth;
                const y = (-screenPosition.y * 0.5 + 0.5) * window.innerHeight;
                p.userData.labelContainer.style.left = `${x}px`;
                p.userData.labelContainer.style.top = `${y}px`;
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function onCanvasClick(event) {
            raycaster.setFromCamera(mouse, camera);
            if (addMode) {
                const intersectPoint = new THREE.Vector3();
                raycaster.ray.intersectPlane(plane, intersectPoint);
                if(intersectPoint) {
                    const charge = addMode === 'positive' ? 1 : -1;
                    createParticle(charge, intersectPoint);
                }
                addMode = null;
                document.body.style.cursor = 'default';
            } else {
                const intersects = raycaster.intersectObjects(particles);
                if (intersects.length > 0) {
                    selectedParticle = intersects[0].object;
                    showChargeModal();
                }
            }
        }

        function showChargeModal() {
            if (!selectedParticle) return;
            const charge = selectedParticle.userData.charge;
            const sign = charge > 0 ? '+' : '−';
            ui.chargeValueDisplay.textContent = `${sign}${Math.abs(charge)} e`;
            ui.chargeValueDisplay.style.color = charge > 0 ? '#38bdf8' : '#f87171';
            ui.modal.style.display = 'flex';
        }

        function hideChargeModal() {
            if (!selectedParticle) return;
            const { charge, labelContainer } = selectedParticle.userData;
            const radius = 1 + Math.log(Math.abs(charge) + 1) * 0.5;
            selectedParticle.geometry.dispose();
            selectedParticle.geometry = new THREE.SphereGeometry(radius, 32, 32);
            const isPositive = charge > 0;
            const newColor = isPositive ? 0x38bdf8 : 0xf87171;
            selectedParticle.material.color.setHex(newColor);
            selectedParticle.material.emissive.setHex(newColor);
            updateLabelContent(labelContainer, charge);
            selectedParticle = null;
            ui.modal.style.display = 'none';
            updateInfoPanel();
        }

        function adjustCharge(amount) {
            if (!selectedParticle) return;
            let currentCharge = selectedParticle.userData.charge;
            let newCharge = currentCharge + amount;
            if (newCharge === 0) newCharge = amount > 0 ? 1 : -1;
            if (Math.abs(newCharge) > 10) return;
            selectedParticle.userData.charge = newCharge;
            showChargeModal();
        }

        function updateInfoPanel() {
            const totalCharge = particles.reduce((sum, p) => sum + p.userData.charge, 0);
            ui.totalCharge.textContent = `${totalCharge} e`;
            ui.particleCount.textContent = particles.length;
        }

        function resetSimulation() {
            particles.forEach(p => {
                scene.remove(p);
                p.geometry.dispose();
                p.material.dispose();
                if (p.userData.labelContainer.parentNode) {
                    document.body.removeChild(p.userData.labelContainer);
                }
            });
            forceLines.forEach(l => {
                scene.remove(l);
                l.geometry.dispose();
                l.material.dispose();
            });
            particles = [];
            forceLines = [];
            updateInfoPanel();
            if (ui.modal.style.display === 'flex') {
                selectedParticle = null;
                ui.modal.style.display = 'none';
            }
        }

        function updatePhysics() {
            if (particles.length < 2) return;
            particles.forEach(p => p.userData.force.set(0, 0, 0));

            const k = 50;
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const p1 = particles[i];
                    const p2 = particles[j];

                    const direction = new THREE.Vector3().subVectors(p1.position, p2.position);
                    const distanceSq = Math.max(direction.lengthSq(), 4);

                    const forceMagnitude = k * (p1.userData.charge * p2.userData.charge) / distanceSq;
                    const force = direction.normalize().multiplyScalar(forceMagnitude);

                    p1.userData.force.add(force);
                    p2.userData.force.sub(force);
                }
            }

            const damping = 0.96;
            particles.forEach(p => {
                const acceleration = p.userData.force;
                p.userData.velocity.add(acceleration);
                p.userData.velocity.multiplyScalar(damping);
                p.position.add(p.userData.velocity.clone().multiplyScalar(0.01));
                p.position.y = 0;
            });
        }

        function updateForceLines() {
            forceLines.forEach(l => { scene.remove(l); l.geometry.dispose(); l.material.dispose(); });
            forceLines = [];

            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const p1 = particles[i];
                    const p2 = particles[j];

                    const isRepulsive = p1.userData.charge * p2.userData.charge > 0;
                    const color = isRepulsive ? 0xff4d4d : 0x4dff4d;

                    const material = new THREE.LineBasicMaterial({ color: color, transparent: true, opacity: 0.6 });
                    const points = [p1.position, p2.position];
                    const geometry = new THREE.BufferGeometry().setFromPoints(points);

                    const line = new THREE.Line(geometry, material);
                    scene.add(line);
                    forceLines.push(line);
                }
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            updatePhysics();
            updateForceLines();
            updateLabels();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>